{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">Calculadora de Salário Mensal e Conversão PJ</h2>

<form method="post" class="card p-4 mt-3">
  <div class="row">
    <div class="col-md-6 mb-3">
      <label for="salario_bruto" class="form-label">Salário Bruto Mensal</label>
      <input type="number" step="0.01" class="form-control" name="salario_bruto" id="salario_bruto" required value="{{ request.form.get('salario_bruto', '') }}">
    </div>
    <div class="col-md-6 mb-3">
      <label for="num_dependentes" class="form-label">Nº de Dependentes</label>
      <input type="number" class="form-control" name="num_dependentes" id="num_dependentes" value="{{ request.form.get('num_dependentes', 0) }}">
    </div>
    <div class="col-md-6 mb-3">
      <label for="va_vr_mensal" class="form-label">Valor Mensal do VA/VR</label>
      <input type="number" step="0.01" class="form-control" name="va_vr_mensal" id="va_vr_mensal" value="{{ request.form.get('va_vr_mensal', 0) }}">
    </div>
    <div class="col-md-6 mb-3">
      <label for="bonus_anual" class="form-label">Bônus Anual / PLR (Valor Total)</label>
      <input type="number" step="0.01" class="form-control" name="bonus_anual" id="bonus_anual" value="{{ request.form.get('bonus_anual', 0) }}">
    </div>
  </div>
  <button class="btn btn-primary mt-4">Calcular Salário Líquido</button>
</form>

{% if resultado %}
<div class="mt-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Resultado do Cálculo</h3>
    <form method="post" action="{{ url_for('export_salario_mensal_pdf') }}" class="m-0">
        <input type="hidden" name="salario_bruto" value="{{ request.form.get('salario_bruto') }}">
        <input type="hidden" name="num_dependentes" value="{{ request.form.get('num_dependentes') }}">
        <input type="hidden" name="va_vr_mensal" value="{{ request.form.get('va_vr_mensal') }}">
        <input type="hidden" name="bonus_anual" value="{{ request.form.get('bonus_anual') }}">
        <button type="submit" class="btn btn-success">Exportar para PDF</button>
    </form>
  </div>

  <table class="table table-striped">
    <tbody>
      {% for item, data in resultado.items() if item != 'Valores por Hora' %}
        {% set is_desconto = '(-)' in item %} {% set is_sugestao = 'Sugestão' in item %} {% if not is_sugestao %}
        {% set is_liquido = 'Líquido' in item %}
        {% set row_class = 'table-danger' if is_desconto else ('table-primary' if is_liquido else '') %}

      <tr class="{{ row_class }}" data-bs-toggle="collapse" href="#collapse-{{ loop.index }}" role="button">
        <td><strong>{{ item }}</strong></td>
        <td class="text-end"><strong>{{ "%.2f"|format(data.valor) }}</strong></td>
      </tr>
      <tr class="collapse" id="collapse-{{ loop.index }}">
        <td colspan="2" class="p-3">
          <small><strong>Como chegamos neste valor:</strong><br>
            <pre style="white-space: pre-wrap; font-family: inherit;">{{ data.calculo }}</pre>
          </small>
        </td>
      </tr>
      {% endif %}
      {% endfor %}
    </tbody>
  </table>

  <div class="card bg-light mt-4">
      <div class="card-header">
          <h4>CLT vs. PJ: Sugestão de Salário</h4>
      </div>
      <div class="card-body">
          <p>Para compensar a ausência de 13º, férias, FGTS e outros benefícios, um salário PJ equivalente seria:</p>
          <h3 class="text-center text-success">R$ {{ "%.2f"|format(resultado['Sugestão Salário PJ'].valor) }} / mês</h3>
          <div class="mt-3">
              <a class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" href="#collapsePJ" role="button">
                Ver cálculo detalhado
              </a>
              <div class="collapse mt-2" id="collapsePJ">
                <pre style="white-space: pre-wrap; font-family: inherit; background-color: #f8f9fa; padding: 1rem; border-radius: 5px;">{{ resultado['Sugestão Salário PJ'].calculo }}</pre>
              </div>
          </div>
          <small class="d-block text-muted mt-3"><strong>Atenção:</strong> Este valor é uma sugestão para equiparar a remuneração total. Como PJ, você terá custos com impostos (Simples Nacional), contabilidade e possivelmente plano de saúde, que devem ser considerados.</small>
      </div>
  </div>

  <div class="card mt-4">
    <div class="card-header">
        <h4>Análise do Valor/Hora</h4>
    </div>
    <div class="card-body">
        <div class="row text-center">
            <div class="col-md-6">
                <div class="p-3 border rounded">
                    <h5>CLT</h5>
                    <p class="h3 text-primary">R$ {{ "%.2f"|format(resultado['Valores por Hora'].clt.valor) }} / hora</p>
                    <small class="text-muted">Considerando 220h mensais.</small>
                </div>
            </div>
            <div class="col-md-6 mt-3 mt-md-0">
                <div class="p-3 border rounded">
                    <h5>PJ (Sugestão)</h5>
                    <p class="h3 text-primary">R$ {{ "%.2f"|format(resultado['Valores por Hora'].pj.valor) }} / hora</p>
                    <small class="text-muted">Considerando 168h mensais.</small>
                </div>
            </div>
        </div>
    </div>
  </div>

  <div class="mt-4">
      <a href="/salario-mensal" class="btn btn-secondary">Novo cálculo</a>
  </div>
</div>
{% endif %}

{% endblock %}