<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Rescisão e Salário</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.30.0/date_fns.min.js"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --card: #ffffff; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: #1e293b; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: var(--card); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        h1, h2 { color: var(--primary); }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; font-weight: 600; margin-bottom: 0.5rem; }
        input, select { width: 100%; padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; padding: 1rem 2rem; border-radius: 6px; cursor: pointer; font-weight: 600; width: 100%; }
        button:hover { background: #1d4ed8; }
        .resultado { margin-top: 2rem; padding: 1.5rem; border: 1px solid #e2e8f0; border-radius: 8px; background: #f1f5f9; }
        .item-resultado { border-bottom: 1px solid #cbd5e1; padding: 0.5rem 0; }
        .valor-negativo { color: #dc2626; }
        .hidden { display: none; }
        .info-calculo { font-size: 0.85rem; color: #64748b; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>Calculadora Trabalhista</h1>
    
    <div class="tabs" style="display: flex; gap: 10px; margin-bottom: 20px;">
        <button onclick="showTab('rescisao')" style="flex:1">Rescisão</button>
        <button onclick="showTab('mensal')" style="flex:1">Salário Mensal/PJ</button>
    </div>

    <section id="tab-rescisao">
        <h2>Cálculo de Rescisão</h2>
        <form id="formRescisao">
            <div class="form-group">
                <label>Salário Bruto (R$)</label>
                <input type="number" id="salario" step="0.01" required>
            </div>
            <div class="form-group">
                <label>Tipo de Rescisão</label>
                <select id="tipo_rescisao">
                    <option value="sem_justa_causa">Demissão sem Justa Causa</option>
                    <option value="pedido_demissao">Pedido de Demissão</option>
                    <option value="justa_causa">Justa Causa</option>
                    <option value="acordo">Acordo Comum</option>
                </select>
            </div>
            <div class="form-group">
                <label>Data de Início</label>
                <input type="date" id="data_inicio" required>
            </div>
            
            <div id="div_padrao">
                <div class="form-group">
                    <label>Data de Afastamento</label>
                    <input type="date" id="data_fim">
                </div>
                <div class="form-group">
                    <label>Dias de Aviso Prévio Devido (Lei 12.506)</label>
                    <input type="number" id="aviso_devido" value="30">
                </div>
                <div class="form-group">
                    <label>Dias de Aviso Cumprido/Trabalhado</label>
                    <input type="number" id="aviso_cumprido" value="0">
                </div>
            </div>

            <div id="div_pedido" class="hidden">
                <div class="form-group">
                    <label>Data da Solicitação</label>
                    <input type="date" id="data_solicitacao">
                </div>
                <label>Vai cumprir o aviso?</label>
                <input type="radio" name="cumprira_aviso" value="sim" checked> Sim
                <input type="radio" name="cumprira_aviso" value="nao"> Não
            </div>

            <div class="form-group">
                <label>Dia do último pagamento (Ciclo Salarial)</label>
                <input type="number" id="dia_pagamento" value="1" min="1" max="31">
            </div>

            <button type="submit">Calcular Rescisão</button>
        </form>
    </section>

    <section id="tab-mensal" class="hidden">
        <h2>Simulação Mensal e PJ</h2>
        <form id="formMensal">
            <div class="form-group">
                <label>Salário Bruto (R$)</label>
                <input type="number" id="m_salario" step="0.01" required>
            </div>
            <div class="form-group">
                <label>Nº de Dependentes</label>
                <input type="number" id="m_dependentes" value="0">
            </div>
            <div class="form-group">
                <label>Bônus Anual Estimado (R$)</label>
                <input type="number" id="m_bonus" value="0">
            </div>
            <div class="form-group">
                <label>VA/VR Mensal (R$)</label>
                <input type="number" id="m_vavr" value="0">
            </div>
            <button type="submit">Calcular Salário Líquido</button>
        </form>
    </section>

    <div id="resultadoArea" class="resultado hidden">
        <h3>Resultado Detalhado</h3>
        <div id="resultadoConteudo"></div>
    </div>
</div>

<script>
// --- CONFIGURAÇÕES E TABELAS 2025 ---
const TABELA_INSS = [
    { limite: 1518.00, aliquota: 0.075 },
    { limite: 2793.88, aliquota: 0.09 },
    { limite: 4190.83, aliquota: 0.12 },
    { limite: 8157.41, aliquota: 0.14 }
];

const TABELA_IRRF = [
    { limite: 2428.80, aliquota: 0.0, deducao: 0.00 },
    { limite: 2826.65, aliquota: 0.075, deducao: 182.16 },
    { limite: 3751.05, aliquota: 0.15, deducao: 394.16 },
    { limite: 4664.68, aliquota: 0.225, deducao: 675.49 },
    { limite: Infinity, aliquota: 0.275, deducao: 908.73 }
];

// --- LÓGICA DE NAVEGAÇÃO ---
function showTab(tab) {
    document.getElementById('tab-rescisao').classList.toggle('hidden', tab !== 'rescisao');
    document.getElementById('tab-mensal').classList.toggle('hidden', tab !== 'mensal');
    document.getElementById('resultadoArea').classList.add('hidden');
}

document.getElementById('tipo_rescisao').addEventListener('change', function(e) {
    const isPedido = e.target.value === 'pedido_demissao';
    document.getElementById('div_pedido').classList.toggle('hidden', !isPedido);
    document.getElementById('div_padrao').classList.toggle('hidden', isPedido);
});

// --- FUNÇÕES DE CÁLCULO (O "Calculos.py" convertido) ---

function calcularInss(base) {
    let inss = 0;
    let limiteAnterior = 0;
    let desc = `Cálculo INSS progressivo sobre R$ ${base.toFixed(2)}:<br>`;

    for (const faixa of TABELA_INSS) {
        if (base > limiteAnterior) {
            let baseFaixa = Math.min(base, faixa.limite) - limiteAnterior;
            let valorFaixa = baseFaixa * faixa.aliquota;
            inss += valorFaixa;
            desc += `- Até R$ ${faixa.limite}: R$ ${baseFaixa.toFixed(2)} x ${faixa.aliquota*100}% = R$ ${valorFaixa.toFixed(2)}<br>`;
            limiteAnterior = faixa.limite;
        }
    }
    return { valor: inss, calculo: desc };
}

function calcularIrrf(base, dependentes = 0) {
    const baseIrrf = base - (dependentes * 189.59);
    let taxa = 0, deducao = 0;
    
    for (const faixa of TABELA_IRRF) {
        if (baseIrrf <= faixa.limite) {
            taxa = faixa.aliquota;
            deducao = faixa.deducao;
            break;
        }
    }
    const valor = Math.max(0, (baseIrrf * taxa) - deducao);
    return { 
        valor: valor, 
        calculo: `Base R$ ${baseIrrf.toFixed(2)} (após dep.). (${baseIrrf.toFixed(2)} * ${taxa*100}%) - ${deducao}` 
    };
}

// --- PROCESSAMENTO DOS FORMULÁRIOS ---

document.getElementById('formRescisao').onsubmit = function(e) {
    e.preventDefault();
    const salario = parseFloat(document.getElementById('salario').value);
    const tipo = document.getElementById('tipo_rescisao').value;
    const dataInicio = new Date(document.getElementById('data_inicio').value);
    let dataFim;

    if (tipo === 'pedido_demissao') {
        const dataSolicitacao = new Date(document.getElementById('data_solicitacao').value);
        const cumprira = document.querySelector('input[name="cumprira_aviso"]:checked').value;
        dataFim = cumprira === 'sim' ? dateFns.addDays(dataSolicitacao, 30) : dataSolicitacao;
    } else {
        dataFim = new Date(document.getElementById('data_fim').value);
    }

    // Cálculos Proporcionais Simplificados
    const meses13 = dataFim.getMonth() + (dataFim.getDate() >= 15 ? 1 : 0);
    const diffMeses = dateFns.differenceInMonths(dataFim, dataInicio);
    
    // Verbas
    const saldoSalario = (salario / 30) * dataFim.getDate();
    const decimoTerceiro = (salario / 12) * meses13;
    const feriasProp = (salario / 12) * (diffMeses % 12);
    const tercoFerias = (feriasProp + (diffMeses >= 12 ? salario : 0)) / 3;

    let html = `
        <div class="item-resultado">Saldo de Salário: <strong>R$ ${saldoSalario.toFixed(2)}</strong></div>
        <div class="item-resultado">13º Proporcional: <strong>R$ ${decimoTerceiro.toFixed(2)}</strong></div>
        <div class="item-resultado">Férias Proporcionais + 1/3: <strong>R$ ${(feriasProp + tercoFerias).toFixed(2)}</strong></div>
    `;

    // Impostos
    const inss = calcularInss(saldoSalario).valor + calcularInss(decimoTerceiro).valor;
    const totalBruto = saldoSalario + decimoTerceiro + feriasProp + tercoFerias;
    
    html += `
        <div class="item-resultado valor-negativo">(-) INSS Estimado: R$ ${inss.toFixed(2)}</div>
        <div class="item-resultado" style="font-size: 1.2rem; margin-top:10px;">
            Total Líquido Estimado: <strong>R$ ${(totalBruto - inss).toFixed(2)}</strong>
        </div>
    `;

    renderResultado(html);
};

document.getElementById('formMensal').onsubmit = function(e) {
    e.preventDefault();
    const bruto = parseFloat(document.getElementById('m_salario').value);
    const dep = parseInt(document.getElementById('m_dependentes').value);
    
    const inss = calcularInss(bruto);
    const irrf = calcularIrrf(bruto - inss.valor, dep);
    const liquido = bruto - inss.valor - irrf.valor;

    // Lógica PJ Sugerido (Baseado no seu Python)
    const bonus = parseFloat(document.getElementById('m_bonus').value) || 0;
    const vavr = parseFloat(document.getElementById('m_vavr').value) || 0;
    const custoAnual = (bruto * 13.33) + (bruto * 0.08 * 12) + (vavr * 12) + bonus;
    const pjSugerido = custoAnual / 12;

    let html = `
        <div class="item-resultado">Salário Bruto: R$ ${bruto.toFixed(2)}</div>
        <div class="item-resultado valor-negativo">(-) INSS: R$ ${inss.valor.toFixed(2)}</div>
        <div class="item-resultado valor-negativo">(-) IRRF: R$ ${irrf.valor.toFixed(2)}</div>
        <div class="item-resultado"><strong>Salário Líquido: R$ ${liquido.toFixed(2)}</strong></div>
        <hr>
        <div class="item-resultado" style="color: var(--primary)">
            <strong>Sugestão de Valor PJ: R$ ${pjSugerido.toFixed(2)} / mês</strong>
            <div class="info-calculo">Considera 13º, Férias, FGTS, VA/VR e Bônus anualizados.</div>
        </div>
    `;
    renderResultado(html);
};

function renderResultado(html) {
    const res = document.getElementById('resultadoArea');
    const cont = document.getElementById('resultadoConteudo');
    res.classList.remove('hidden');
    cont.innerHTML = html;
    res.scrollIntoView({ behavior: 'smooth' });
}
</script>

</body>
</html>